<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Dashboard">
    <meta name="author" content="NearSat PTY LTD">

    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!--title>NearSat - Analytics</title-->
    <title>NearSat - Dashboard</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400" rel="stylesheet" type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="css/creative.min.css">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.js'></script>

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.css' rel='stylesheet' />

    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
    <script src='./js/mapbox-gl-draw.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.0/mapbox-gl-draw.css' type='text/css'/>

    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.1.1/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.1.1/mapbox-gl-geocoder.css' type='text/css' />

    <link rel="stylesheet" href="css/dashboard.css">

    <link href="./css/jquery-ui.css" rel="stylesheet">

    <script src="./js/autoNumeric.js" type="text/javascript"></script>
    <script src="./js/autoNumeric.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/autonumeric@4.0.1/dist/autoNumeric.min.js"></script>

    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">


</head>

<body>
	<div class='sidebar pad2' id="cart" >

    <div id="topsection">
    <div style="padding-top: 20px;"></div>

    <div class="container1" style="text-align: center;">
        <img style="height: 45px; padding: 0; margin: 0" src="./img/NearSat_Logo_Black.png">
        <div class='site-header' style="margin-top:12px;">Site Dashboard</div>
        <div style="height: 1.2px; margin-top: 15px; background-color: #111111; text-align: center; width:90%; margin-left: 4.5%; margin-bottom: 5px"></div>
    </div>

    <div type="header" onclick="location.href = 'site-details-veuron.html';">
        <div class="sitename" id="Agsite">Agriculture Site</div><input type="button" class="toggle" value="^">
    </div>   
    </div>   
    
    <!--div class="content">
        <div class="form-input">
            <input type="description" value="Veuron">
        </div>
        
        <div class="calculation-box" id="fgh">Select area to image.</div>
        <span id="calculated-area"></span>                  
    </div-->

        <ul id="listsection" style="padding:0; margin:0; width:100%;"></ul>

        <div id="addsitediv" style="padding:0; margin:0; text-align:center;">
            <input type="button" name="submit" id="login-btn" value="Add Site" class="btn-addsite">
        </div>

        <div id="filler" style="width: 100%"></div>
    </div>

    <!--- Map Section -->
    <div id='map' class='map pad2'></div>
    <div id='menu'>

    <label style="margin: 0;">
        <input id='satellite' type='radio' name='rtoggle' value='Satellite'>
        <span class="label-text">Satellite</span>
    </label>

    <label style="margin: 0;">
        <input id='streets' type='radio' name='rtoggle' value='Street'>
        <span class="label-text">Street</span>
    </label>
</div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYnlyb25hZXJvIiwiYSI6ImNpaGgxeGkzaTBtZjl0Y2x6bmp6YW02NnQifQ.4tkhTXyt_T7Cfxbmre8Z-w';
        // This adds the map to your page
        var map = new mapboxgl.Map({
        // container id specified in the HTML
        container: 'map',
        // style URL
        style: 'mapbox://styles/mapbox/satellite-v9',
        // initial position in [lon, lat] format
        center: [134.108956, -25.585480],
        // initial zoom
        zoom: 3.3
        });

        map.on("load", function() {
        var items = JSON.parse(localStorage.getItem("cart"));
        var agcoord = JSON.parse(localStorage.getItem("agdata"));
        if(items !== null){
        var polydata = [];
        for (i = 0; i < items.length; i++) {
                ///concatenate the items;
                polydata = polydata.concat([items[i].coordinates])
                console.log(polydata);
        }

        // Adding polygons
        if(items.length==1) {
                map.addSource("sites", {
                "type": "geojson",
                "data": {
                    "type": "FeatureCollection",
                    "features": [{
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [agcoord]
                        },
                    }, {
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [polydata[0]]
                        },                        
                    }]
                }
            });
        } else {

                        map.addSource("sites", {
                "type": "geojson",
                "data": {
                    "type": "FeatureCollection",
                    "features": [{
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [agcoord]
                        }
                    }, {
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [polydata[0]]
                        }
                    }, {
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [polydata[1]]
                        }
                    }]
                }
            });

        }

        } else {
            map.addSource("sites", {
                "type": "geojson",
                "data": {
                    "type": "FeatureCollection",
                    "features": [{
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [agcoord]
                        },
                    }]
                }
            });
        }

            map.addLayer({
        "id": "my-site",
        "type": "fill",
        "source": "sites",
        "paint": {
            "fill-color": "#27e846",
            "fill-opacity": 0.5
        }
    });

    });

        map.addControl(new MapboxGeocoder({
        accessToken: mapboxgl.accessToken
        }));

        var draw = new MapboxDraw({
        displayControlsDefault: false,
        controls: {
        polygon: true,
        trash: true
        }
        });

        map.addControl(draw);


        var layerList = document.getElementById('menu');
var inputs = layerList.getElementsByTagName('input');

function switchLayer(layer) {
    var layerId = layer.target.id;
    map.setStyle('mapbox://styles/mapbox/' + layerId + '-v9');
}

for (var i = 0; i < inputs.length; i++) {
    inputs[i].onclick = switchLayer;
}
    </script>

        <!-- jQuery -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/jquery/jquery.js"></script>

                <!-- jQuery UI -->
    <script src="external/jquery/jquery.js"></script>
    <script src="./js/jquery-ui.js"></script>


    <!-- Dashboard Functions -->
    <script src="./js/dash.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="vendor/scrollreveal/scrollreveal.min.js"></script>

    <!-- Theme JavaScript -->
    <script src="js/creative.min.js"></script>



</body>

</html>